<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n: Alsacia - Gu√≠a de Viaje</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>

    <style>
        /* Estilos personalizados para el mapa y scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        .user-location-pulse::before {
            content: '';
            position: absolute;
            left: -15px; top: -15px; width: 50px; height: 50px;
            background-color: rgba(59, 130, 246, 0.4);
            border-radius: 50%;
            animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. PREPARACI√ìN DE LIBRER√çAS (Sustituye a los imports) ---
        const { useState, useEffect, useRef } = React;
        
        // Extraemos los iconos de la librer√≠a global lucideReact
        const { 
            MapPin, Clock, Euro, Utensils, ShoppingBag, Info, Navigation, 
            Coffee, Wine, BedDouble, Phone, Locate, Heart, 
            Castle, Gamepad2, Ghost, Rocket, Star, Map, Gift, ExternalLink 
        } = lucideReact;

        // --- 2. COMPONENTE PRINCIPAL (Tu c√≥digo original) ---

        const ColmarGuide = () => {
            const [activeTab, setActiveTab] = useState('places');
            const [selectedPlaceId, setSelectedPlaceId] = useState(null);
            const [userLocation, setUserLocation] = useState(null);
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersRef = useRef({});
            const userMarkerRef = useRef(null);

            // --- DATOS (DATABASE) ---
            const hotel = {
                id: 99,
                name: "Vuestro Hotel (Colmarappart)",
                address: "1 Rue des Clefs, 68000 Colmar",
                phone: "+33 3 89 23 03 03",
                desc: "Vuestro cuartel general. El sitio perfecto para descansar despu√©s de caminar.",
                lat: 48.0788, 
                lng: 7.3605,
                type: 'hotel'
            };

            const places = [
                { id: 1, name: "La Petite Venise", description: "El sitio m√°s bonito para las fotos. Canales preciosos y casas de colores.", price: "Pasear es gratis", hours: "Siempre abierto", lat: 48.0744, lng: 7.3586, type: "sight", icon: "üì∏" },
                { id: 8, name: "Maison Pfister", description: "Una casa de cuento medieval. Dicen que inspir√≥ la pel√≠cula 'El Castillo Ambulante'.", price: "Ver fachada gratis", hours: "Siempre abierto", lat: 48.0777, lng: 7.3575, type: "sight", icon: "üè∞" },
                { id: 9, name: "Ko√Øfhus (Antigua Aduana)", description: "Un edificio hist√≥rico precioso. Fijaos en el tejado de colores.", price: "Gratis entrar al patio", hours: "09:00 - 18:00", lat: 48.0758, lng: 7.3592, type: "sight", icon: "‚öñÔ∏è" },
                { id: 2, name: "Museo Unterlinden", description: "Un museo muy importante en un antiguo convento. Tienen arte famoso.", price: "~13‚Ç¨ (Entrada)", hours: "09:00 - 18:00 (Cierra Martes)", lat: 48.0798, lng: 7.3556, type: "museum", icon: "üé®" },
                { id: 10, name: "Museo del Juguete", description: "Muy curioso de ver. Tienen trenes antiguos, mu√±ecas y juguetes de todas las √©pocas.", price: "~6‚Ç¨", hours: "10:00 - 17:00 (Cierra Martes)", lat: 48.0783, lng: 7.3533, type: "museum", icon: "üß∏" },
                { id: 3, name: "Catedral Saint-Martin", description: "Es impresionante. Mirad arriba a ver si veis nidos de cig√ºe√±as.", price: "Entrada libre", hours: "08:00 - 18:00", lat: 48.0776, lng: 7.3582, type: "sight", icon: "‚õ™" },
                { id: 4, name: "Maison des T√™tes", description: "La fachada tiene 106 cabezas esculpidas. ¬°A ver cu√°ntas veis!", price: "Ver fachada gratis", hours: "Siempre abierto", lat: 48.0786, lng: 7.3558, type: "sight", icon: "üóø" },
                { id: 11, name: "Estatua de la Libertad (R√©plica)", description: "Curiosidad: El escultor era de aqu√≠. Est√° en una rotonda a la entrada de la ciudad.", price: "Gratis", hours: "Aire libre", lat: 48.0988, lng: 7.3619, type: "sight", icon: "üóΩ" },
                { id: 5, name: "Mercado Cubierto", description: "Mercado tradicional. Ideal para comprar algo de picar o ver productos locales.", price: "Entrada libre", hours: "08:00 - 18:00 (Cierra Lun)", lat: 48.0754, lng: 7.3592, type: "food", icon: "üçó" },
                { id: 6, name: "Eguisheim (Pueblo cercano)", description: "A 7km. Es un pueblo circular precioso, lleno de flores. Muy recomendado.", price: "Ir en Bus/Coche", hours: "Mejor por la ma√±ana", lat: 48.0448, lng: 7.3073, type: "nearby", icon: "üåπ" },
                { id: 7, name: "Riquewihr (Pueblo cercano)", description: "A 13km. Un pueblo medieval amurallado entre vi√±edos.", price: "Ir en Bus/Coche", hours: "Todo el d√≠a", lat: 48.1664, lng: 7.2976, type: "nearby", icon: "üçá" }
            ];

            const foods = [
                { name: "Tarte Flamb√©e", desc: "Parecido a una pizza muy fina con crema y bacon. ¬°Riqu√≠sima!", icon: <Utensils className="w-5 h-5" /> },
                { name: "Choucroute", desc: "El plato t√≠pico: Col fermentada con muchas salchichas y carne.", icon: <Utensils className="w-5 h-5" /> },
                { name: "Baeckeoffe", desc: "Un estofado de carne con patatas muy sabroso.", icon: <Utensils className="w-5 h-5" /> },
                { name: "Bretzel", desc: "El lazo de pan salado t√≠pico. Perfecto para matar el hambre.", icon: <Coffee className="w-5 h-5" /> },
                { name: "Queso Munster", desc: "El queso famoso de aqu√≠. Huele fuerte pero sabe muy bien.", icon: <Utensils className="w-5 h-5" /> }
            ];

            const products = [
                { name: "Vinos de Alsacia", desc: "Riesling (blanco seco) o Gewurztraminer (m√°s dulce).", icon: <Wine className="w-5 h-5" /> },
                { name: "Kugelhopf", desc: "Un bizcocho alto con forma de monta√±a t√≠pico de aqu√≠.", icon: <Gift className="w-5 h-5" /> },
                { name: "Adornos de Navidad", desc: "Aqu√≠ es Navidad todo el a√±o, hay tiendas preciosas.", icon: <Star className="w-5 h-5" /> }
            ];

            // --- MAPA ENGINE ---
            useEffect(() => {
                if (!document.getElementById('leaflet-css')) {
                    const link = document.createElement('link');
                    link.id = 'leaflet-css';
                    link.rel = 'stylesheet';
                    link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
                    document.head.appendChild(link);
                }

                if (!document.getElementById('leaflet-js')) {
                    const script = document.createElement('script');
                    script.id = 'leaflet-js';
                    script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
                    script.async = true;
                    script.onload = initMap;
                    document.head.appendChild(script);
                } else {
                    if (window.L) initMap();
                }
            }, []);

            const initMap = () => {
                if (!mapRef.current || mapInstanceRef.current) return;
                // Peque√±o delay para asegurar que L est√° cargado
                if(!window.L) { setTimeout(initMap, 500); return; }

                const map = window.L.map(mapRef.current, { zoomControl: false }).setView([48.0794, 7.3586], 14);

                window.L.control.zoom({ position: 'topright' }).addTo(map);
                
                window.L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'OpenStreetMap', subdomains: 'abcd', maxZoom: 20
                }).addTo(map);

                mapInstanceRef.current = map;
                addMarkers(map);
            };

            const createCustomIcon = (color, iconHtml) => {
                return window.L.divIcon({
                    className: 'custom-pin',
                    html: `
                        <div style="background-color: ${color}; width: 36px; height: 36px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 3px 3px 10px rgba(0,0,0,0.4);">
                        <div style="transform: rotate(45deg); font-size: 18px; line-height: 1;">${iconHtml}</div>
                        </div>`,
                    iconSize: [36, 48], iconAnchor: [18, 48], popupAnchor: [0, -48]
                });
            };

            const addMarkers = (map) => {
                places.forEach(place => {
                    const color = place.type === 'nearby' ? '#6366f1' : '#0ea5e9';
                    const marker = window.L.marker([place.lat, place.lng], { icon: createCustomIcon(color, place.icon) })
                    .addTo(map)
                    .bindPopup(`<div style="text-align: center;"><b>${place.name}</b><br>üìç Lugar de inter√©s</div>`);
                    
                    marker.on('click', () => { setSelectedPlaceId(place.id); setActiveTab('places'); });
                    markersRef.current[place.id] = marker;
                });

                const hotelMarker = window.L.marker([hotel.lat, hotel.lng], { icon: createCustomIcon('#1e40af', 'üè∞') })
                .addTo(map)
                .bindPopup(`<div style="text-align:center"><b>${hotel.name}</b><br>Vuestro Hotel</div>`);
                
                hotelMarker.on('click', () => { setActiveTab('hotel'); });
                markersRef.current['hotel'] = hotelMarker;
            };

            const flyToLocation = (lat, lng, zoom = 16) => {
                if (mapInstanceRef.current) { mapInstanceRef.current.flyTo([lat, lng], zoom, { duration: 1.5 }); }
            };

            useEffect(() => {
                if (activeTab === 'hotel') {
                    flyToLocation(hotel.lat, hotel.lng);
                    markersRef.current['hotel']?.openPopup();
                } else if (selectedPlaceId && activeTab === 'places') {
                    const place = places.find(p => p.id === selectedPlaceId);
                    if (place) {
                        flyToLocation(place.lat, place.lng);
                        markersRef.current[selectedPlaceId]?.openPopup();
                    }
                }
            }, [selectedPlaceId, activeTab]);

            const handleLocateMe = () => {
                if (!navigator.geolocation) { alert("Tu dispositivo no soporta el minimapa."); return; }
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        setUserLocation({ lat: latitude, lng: longitude });
                        flyToLocation(latitude, longitude, 17);
                        if (mapInstanceRef.current) {
                            if (userMarkerRef.current) {
                                userMarkerRef.current.setLatLng([latitude, longitude]);
                            } else {
                                const userIcon = window.L.divIcon({
                                    className: 'user-location-pulse',
                                    html: `<div style="width: 20px; height: 20px; background: #3b82f6; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5);"></div>`,
                                    iconSize: [20, 20]
                                });
                                userMarkerRef.current = window.L.marker([latitude, longitude], { icon: userIcon }).addTo(mapInstanceRef.current);
                                userMarkerRef.current.bindPopup("Est√°s aqu√≠").openPopup();
                            }
                        }
                    },
                    (error) => { console.error("Error GPS:", error); alert("No se pudo obtener la ubicaci√≥n. Activa el GPS."); }
                );
            };

            return (
                <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800">
                    <header className="bg-blue-900 text-white p-4 shadow-xl z-20 flex justify-between items-center relative overflow-hidden">
                        <div className="absolute top-0 right-0 opacity-20 pointer-events-none transform translate-x-4 -translate-y-2"><Star size={100} /></div>
                        <div>
                            <h1 className="text-xl md:text-2xl font-black flex items-center gap-3 tracking-wide uppercase" style={{ textShadow: '2px 2px 0px #1e40af' }}>
                                <Rocket className="text-cyan-400" /> Misi√≥n: Alsacia
                            </h1>
                            <p className="text-xs md:text-sm text-cyan-200 mt-1 font-mono">> Viajeros: Family de Tati</p>
                        </div>
                    </header>
                    <div className="flex flex-1 overflow-hidden relative flex-col md:flex-row">
                        <div className="w-full md:w-1/3 lg:w-[420px] bg-white flex flex-col border-r border-slate-200 shadow-2xl z-10 h-[60%] md:h-full">
                            <div className="flex bg-slate-50 p-1 gap-1 border-b border-slate-200">
                                {[{ id: 'places', icon: <Map size={18} />, label: 'Lugares' }, { id: 'food', icon: <Utensils size={18} />, label: 'Comer' }, { id: 'products', icon: <Gift size={18} />, label: 'Tiendas' }, { id: 'hotel', icon: <Castle size={18} />, label: 'Hotel' }].map(tab => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 py-3 rounded-lg text-xs md:text-sm font-bold flex flex-col justify-center items-center gap-1 transition-all text-center leading-tight ${activeTab === tab.id ? 'bg-blue-600 text-white shadow-md transform -translate-y-0.5' : 'text-slate-500 hover:bg-blue-100 hover:text-blue-600'}`}>{tab.icon} <span>{tab.label}</span></button>
                                ))}
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 custom-scrollbar">
                                {activeTab === 'hotel' && (
                                    <div className="animate-in fade-in slide-in-from-left-4 duration-300">
                                        <div className="bg-white p-6 rounded-2xl border-2 border-blue-600 shadow-lg relative">
                                            <div className="absolute top-3 right-3 text-blue-600 animate-bounce"><Castle size={32} /></div>
                                            <h2 className="text-xl font-black text-blue-800 mb-1">{hotel.name}</h2>
                                            <p className="text-slate-500 mb-4 text-sm font-medium">{hotel.desc}</p>
                                            <div className="space-y-3 mb-6 bg-blue-50 p-3 rounded-lg">
                                                <div className="flex items-center gap-2 text-sm"><MapPin className="text-blue-500 w-4 h-4" /><span className="font-bold text-slate-700">{hotel.address}</span></div>
                                                <div className="flex items-center gap-2 text-sm"><Phone className="text-blue-500 w-4 h-4" /><span className="font-mono text-slate-700">{hotel.phone}</span></div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <button onClick={() => flyToLocation(hotel.lat, hotel.lng)} className="bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-xl text-sm font-bold shadow transition-colors flex justify-center items-center gap-2"><MapPin size={16} /> Ver en Mapa</button>
                                                <a href={`https://www.google.com/maps/search/?api=1&query=${hotel.lat},${hotel.lng}`} target="_blank" rel="noopener noreferrer" className="bg-cyan-500 hover:bg-cyan-600 text-white py-2.5 rounded-xl text-sm font-bold shadow transition-colors flex justify-center items-center gap-2"><Navigation size={16} /> GPS GO!</a>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'places' && (
                                    <div className="space-y-4 animate-in fade-in duration-300">
                                        <div className="bg-blue-100 p-3 rounded-lg border border-blue-200 text-blue-900 text-xs flex gap-2 items-center"><Ghost className="shrink-0 w-4 h-4" /><p>¬°Aqu√≠ ten√©is lo importante! Tocad para ver d√≥nde est√° en el mapa.</p></div>
                                        {places.map(place => (
                                            <div key={place.id} className={`group p-4 rounded-xl border-2 transition-all relative overflow-hidden bg-white ${selectedPlaceId === place.id ? 'border-blue-500 shadow-lg ring-1 ring-blue-500' : 'border-slate-200 hover:border-cyan-300 hover:shadow-md'}`}>
                                                <div className="flex justify-between items-start mb-2 cursor-pointer" onClick={() => setSelectedPlaceId(place.id)}>
                                                    <div className="flex items-center gap-2"><span className="text-2xl">{place.icon}</span><h3 className={`font-bold text-lg leading-tight ${selectedPlaceId === place.id ? 'text-blue-600' : 'text-slate-800'}`}>{place.name}</h3></div>
                                                    {place.type === 'nearby' && <span className="text-[10px] font-bold uppercase bg-indigo-100 text-indigo-600 px-2 py-1 rounded shrink-0 ml-2">Excursi√≥n</span>}
                                                </div>
                                                <p className="text-sm text-slate-600 mb-4 cursor-pointer" onClick={() => setSelectedPlaceId(place.id)}>{place.description}</p>
                                                <div className="flex items-center justify-between mt-2 pt-3 border-t border-slate-100">
                                                    <div className="flex items-center gap-3 text-xs font-bold text-slate-400">
                                                        <div className="flex items-center gap-1"><Euro size={14} /> {place.price}</div>
                                                        <div className="flex items-center gap-1"><Clock size={14} /> {place.hours}</div>
                                                    </div>
                                                    <a href={`https://www.google.com/maps/search/?api=1&query=${place.lat},${place.lng}`} target="_blank" rel="noopener noreferrer" className="bg-cyan-100 hover:bg-cyan-200 text-cyan-700 px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-1 transition-colors" onClick={(e) => e.stopPropagation()}><Navigation size={12} /> C√≥mo llegar</a>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                {activeTab === 'food' && (
                                    <div className="space-y-4 animate-in fade-in duration-300">
                                        <h3 className="font-black text-lg text-blue-900 px-1 mb-2 flex items-center gap-2"><Utensils className="w-5 h-5" /> Platos que deb√©is probar</h3>
                                        {foods.map((food, idx) => (
                                            <div key={idx} className="flex gap-4 p-4 bg-white rounded-xl shadow-sm border border-slate-200 hover:border-orange-300 transition-colors">
                                                <div className="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0 shadow-sm">{food.icon}</div>
                                                <div><h4 className="font-bold text-slate-800">{food.name}</h4><p className="text-sm text-slate-500">{food.desc}</p></div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                {activeTab === 'products' && (
                                    <div className="space-y-4 animate-in fade-in duration-300">
                                        <h3 className="font-black text-lg text-blue-900 px-1 mb-2 flex items-center gap-2"><Gift className="w-5 h-5" /> Cosas para buscar en tiendas</h3>
                                        {products.map((prod, idx) => (
                                            <div key={idx} className="flex gap-4 p-4 bg-white rounded-xl shadow-sm border border-slate-200 hover:border-purple-300 transition-colors">
                                                <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 shrink-0 shadow-sm">{prod.icon}</div>
                                                <div><h4 className="font-bold text-slate-800">{prod.name}</h4><p className="text-sm text-slate-500">{prod.desc}</p></div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="w-full md:w-2/3 h-[40%] md:h-full bg-slate-200 relative">
                            <div ref={mapRef} className="w-full h-full z-0" />
                            <button onClick={handleLocateMe} className="absolute bottom-6 right-6 z-[400] bg-blue-600 text-white p-3 rounded-full shadow-xl hover:bg-blue-700 hover:scale-110 transition-all border-2 border-white" title="¬øD√≥nde estoy?"><Locate size={24} /></button>
                            <div className="absolute top-4 right-4 bg-white/95 backdrop-blur px-3 py-2 rounded-lg shadow-lg border border-blue-200 text-xs font-bold z-[400] hidden md:block">
                                <div className="flex items-center gap-2 mb-1"><span className="w-3 h-3 bg-cyan-500 rounded-full border border-white shadow"></span> Cosas Interesantes</div>
                                <div className="flex items-center gap-2 mb-1"><span className="w-3 h-3 bg-indigo-500 rounded-full border border-white shadow"></span> Excursiones cercanas</div>
                                <div className="flex items-center gap-2"><span className="w-3 h-3 bg-blue-800 rounded-full border border-white shadow"></span> Hotel</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. RENDERIZADO ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ColmarGuide />);
    </script>
</body>
</html>
